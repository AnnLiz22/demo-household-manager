<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Details</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/tasks}">Tasks</a></li>
            <li class="breadcrumb-item active" aria-current="page" th:text="${task.title}"></li>
        </ol>
    </nav>

    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h2 th:text="${task.title}" class="mb-0"></h2>
            <div>
                    <span class="badge" th:classappend="${task.completed ? 'bg-success' : 'bg-warning'}"
                          th:text="${task.completed ? 'Completed' : 'Pending'}"></span>
            </div>
        </div>
        <div class="card-body">
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5>Details</h5>
                    <dl class="row">
                        <dt class="col-sm-4">Category:</dt>
                        <dd class="col-sm-8" th:text="${task.category}"></dd>

                        <dt class="col-sm-4">Created:</dt>
                        <dd class="col-sm-8" th:text="${#temporals.format(task.createdAt, 'yyyy-MM-dd HH:mm')}"></dd>

                        <dt class="col-sm-4">Due Date:</dt>
                        <dd class="col-sm-8" th:text="${task.dueDate != null ? #temporals.format(task.dueDate, 'yyyy-MM-dd HH:mm') : 'No deadline'}"></dd>

                        <dt class="col-sm-4">Completed:</dt>
                        <dd class="col-sm-8" th:text="${task.completedAt != null ? #temporals.format(task.completedAt, 'yyyy-MM-dd HH:mm') : 'Not completed'}"></dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <h5>Assignment</h5>
                    <dl class="row">
                        <dt class="col-sm-4">Assignee:</dt>
                        <dd class="col-sm-8" th:text="${task.assignee != null ? task.assignee.name : 'Unassigned'}"></dd>

                        <dt class="col-sm-4">Executor:</dt>
                        <dd class="col-sm-8" th:text="${task.executor != null ? task.executor.name : 'Unassigned'}"></dd>
                    </dl>
                </div>
            </div>

            <h5>Description</h5>
            <p class="bg-light p-3 rounded" th:text="${task.description ?: 'No description provided.'}"></p>

            <div class="mt-4" th:if="${!task.comments.empty}">
                <h5>Comments</h5>
                <div class="list-group">
                    <div class="list-group-item list-group-item-action flex-column align-items-start"
                         th:each="comment : ${task.comments}">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1" th:text="${comment.author != null ? comment.author.name : 'Unknown'}"></h6>
                            <small th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></small>
                        </div>
                        <p class="mb-1" th:text="${comment.content}"></p>
                    </div>
                </div>
            </div>

            <div class="mt-4 d-flex gap-2">
                <a th:href="@{/tasks/{id}/edit(id=${task.id})}" class="btn btn-primary">Edit Task</a>

                <a th:href="@{/tasks/{id}/complete(id=${task.id})}"
                   th:unless="${task.completed}"
                   class="btn btn-success">Mark as Complete</a>

                <a th:href="@{/tasks/{id}/delete(id=${task.id})}"
                   class="btn btn-danger"
                   onclick="return confirm('Are you sure you want to delete this task?')">Delete Task</a>

                <a th:href="@{/tasks}" class="btn btn-outline-secondary">Back to List</a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>
</html>